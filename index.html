<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>„Çπ„Éù„ÉÅ„É£„É≥ÂãïÁîª„É©„Ç§„Éñ„É©„É™</title>
    <style>
        :root {
            --primary-color: #ff0000;
            --bg-color: #f9f9f9;
            --card-bg: #ffffff;
            --text-main: #0f0f0f;
            --text-sub: #606060;
            --highlight-bg: #f0f0f0;
            --playlist-badge-bg: #e5e5e5;
            --btn-bg: #f2f2f2;
        }

        body {
            font-family: Roboto, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0; padding: 0;
            overscroll-behavior-y: none;
        }

        .hidden { display: none !important; }

        #maintenanceScreen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #fff; z-index: 9999; display: none;
            flex-direction: column; justify-content: center; align-items: center; text-align: center;
        }
        .maint-icon { font-size: 4rem; margin-bottom: 20px; }

        header {
            background-color: var(--card-bg);
            padding: 15px 20px;
            position: sticky; top: 0; z-index: 1000;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: flex; flex-direction: column; align-items: center;
        }
        h1 { font-size: 1.5rem; color: #333; margin: 0 0 15px 0; }

        .search-container {
            width: 100%; max-width: 800px;
            display: flex; flex-direction: column; gap: 10px;
        }
        @media (min-width: 600px) { .search-container { flex-direction: row; } }

        .input-wrapper { 
            position: relative; 
            width: 100%; 
            z-index: 1; 
        }
        .input-wrapper:focus-within {
            z-index: 10000; 
        }
        
        input[type="text"], input[type="search"] {
            width: 100%; padding: 12px 50px 12px 20px;
            font-size: 16px;
            border: 1px solid #ccc; border-radius: 24px;
            box-sizing: border-box; background-color: #fff; transition: 0.2s;
            appearance: none; position: relative;
        }
        input:focus { outline: none; border-color: #1c62b9; box-shadow: 0 1px 6px rgba(32,33,36,0.28); }

        input[type="search"]::-webkit-search-cancel-button {
            -webkit-appearance: none; appearance: none; display: none;
        }

        .clear-btn {
            position: absolute; right: 5px; top: 50%; transform: translateY(-50%);
            width: 44px; height: 44px;
            border: none; background: transparent;
            font-size: 24px; color: #999; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            opacity: 0; pointer-events: none; transition: opacity 0.2s;
        }
        .clear-btn.visible { opacity: 1; pointer-events: auto; }
        .clear-btn:active { color: #333; }

        input.active {
            border-radius: 24px 24px 0 0 !important;
            border-bottom: 1px solid transparent !important;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1) !important;
        }

        .suggestions-box {
            position: absolute; top: 100%; left: 0; right: 0;
            background: #fff; 
            border: 1px solid #ccc; border-top: none;
            border-radius: 0 0 24px 24px; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: none; overflow-y: auto; max-height: 50vh;
            margin-top: -1px;
        }
        .suggestion-item { padding: 10px 15px; cursor: pointer; display: flex; align-items: center; font-size: 14px; border-bottom: 1px solid #f5f5f5; }
        .suggestion-item:hover { background-color: var(--highlight-bg); }
        .icon { margin-right: 8px; color: var(--text-sub); }

        .status-bar { max-width: 1200px; margin: 10px auto 0; padding: 0 20px; text-align: right; font-size: 0.9rem; color: var(--text-sub); }
        .video-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px; padding: 20px; max-width: 1200px; margin: 0 auto;
        }
        
        .video-card {
            background: var(--card-bg); border-radius: 12px; overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); transition: 0.2s;
            cursor: pointer; display: flex; flex-direction: column;
            content-visibility: auto; contain-intrinsic-size: 300px;
        }
        .video-card:hover { transform: translateY(-4px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .thumbnail-wrapper { position: relative; width: 100%; padding-top: 56.25%; background: #eee; }
        .thumbnail-img { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; }
        .info { padding: 12px; flex-grow: 1; display: flex; flex-direction: column; justify-content: space-between; }
        .title {
            font-size: 1rem; font-weight: 600; line-height: 1.4; margin-bottom: 8px;
            display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;
        }
        .playlist-badge {
            display: inline-block; background-color: var(--playlist-badge-bg); color: #555;
            font-size: 0.75rem; padding: 2px 8px; border-radius: 4px; margin-bottom: 6px;
            align-self: flex-start; max-width: 100%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }
        .url-text { font-size: 0.75rem; color: var(--text-sub); display: flex; justify-content: flex-end; align-items: center; gap: 5px; }

        #detailPage {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #fff; z-index: 2000; overflow-y: auto;
            display: none; flex-direction: column;
        }
        .detail-header {
            padding: 10px 20px; background: #fff; border-bottom: 1px solid #eee;
            position: sticky; top: 0; z-index: 100; display: flex; align-items: center; height: 50px;
        }
        .back-btn {
            background: none; border: none; cursor: pointer;
            font-size: 1rem; color: #333; display: flex; align-items: center; gap: 8px;
            font-weight: 500; padding: 5px 10px; border-radius: 20px; transition: background 0.2s;
        }
        .back-btn:hover { background-color: #f0f0f0; }
        .back-icon { width: 24px; height: 24px; fill: currentColor; }

        .detail-content { max-width: 900px; width: 100%; margin: 0 auto; padding: 20px; box-sizing: border-box; }
        .video-container {
            position: relative; width: 100%; padding-top: 56.25%; background: #000; margin-bottom: 15px; border-radius: 12px; overflow: hidden;
        }
        .video-container iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; }
        .detail-title { font-size: 1.4rem; font-weight: bold; margin-bottom: 15px; line-height: 1.4; }

        .action-bar { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .action-btn {
            display: flex; align-items: center; gap: 6px;
            background-color: var(--btn-bg); color: #333;
            border: none; padding: 8px 16px; border-radius: 20px;
            cursor: pointer; font-size: 0.9rem; font-weight: 500; transition: 0.2s;
        }
        .action-btn:hover { background-color: #e0e0e0; }
        .action-btn svg { width: 18px; height: 18px; fill: currentColor; }
        .action-btn.primary { background-color: #333; color: #fff; }
        .action-btn.primary:hover { background-color: var(--primary-color); }

        .detail-meta { padding: 15px; background: #f9f9f9; border-radius: 8px; border: 1px solid #eee; }
        .detail-row { margin-bottom: 8px; display: flex; flex-wrap: wrap; gap: 10px; align-items: baseline; font-size: 0.95rem; }
        .label { font-weight: bold; color: #666; width: 100px; flex-shrink: 0; }
        .value { color: #333; word-break: break-all; flex: 1; }
        .value a { color: #0066cc; text-decoration: none; }
        .value a:hover { text-decoration: underline; }
        .ext-link { font-size: 0.85em; color: #666; margin-left: 5px; }

        #copyToast {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            background: rgba(0,0,0,0.8); color: white; padding: 10px 20px;
            border-radius: 30px; font-size: 14px; z-index: 3000;
            opacity: 0; transition: opacity 0.3s; pointer-events: none;
        }
        #copyToast.show { opacity: 1; }

        .loading, .no-result { text-align: center; margin-top: 50px; color: var(--text-sub); width: 100%; }
        .spinner {
            border: 4px solid #f3f3f3; border-top: 4px solid var(--primary-color);
            border-radius: 50%; width: 40px; height: 40px;
            animation: spin 1s linear infinite; margin: 20px auto;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        #scrollSentinel { height: 50px; width: 100%; }
    </style>
</head>
<body>

<div id="maintenanceScreen">
    <div class="maint-icon">üîß</div>
    <h2>„Ç∑„Çπ„ÉÜ„É†„É°„É≥„ÉÜ„Éä„É≥„Çπ‰∏≠</h2>
    <p>ÊØéÊó• 0:00 „Äú 0:20 „ÅÆÈñì„ÅØ„ÅîÂà©Áî®„ÅÑ„Åü„Å†„Åë„Åæ„Åõ„Çì„ÄÇ</p>
</div>
<div id="copyToast">URL„Çí„Ç≥„Éî„Éº„Åó„Åæ„Åó„Åü</div>

<div id="mainView">
    <header>
        <h1>„Çπ„Éù„ÉÅ„É£„É≥ÂãïÁîªÊ§úÁ¥¢</h1>
        <div class="search-container">
            <div class="input-wrapper">
                <input type="search" id="searchInput" placeholder="ÂãïÁîª„Çø„Ç§„Éà„É´„ÇíÊ§úÁ¥¢..." disabled autocomplete="off" name="search_q_uniq" enterkeyhint="search">
                <button id="clearSearch" class="clear-btn">√ó</button>
                <div id="suggestionsBox" class="suggestions-box"></div>
            </div>
            <div class="input-wrapper">
                <input type="search" id="playlistSearchInput" placeholder="„Éó„É¨„Ç§„É™„Çπ„Éà„ÅßÁµû„ÇäËæº„Åø..." disabled autocomplete="off" name="search_p_uniq" enterkeyhint="search">
                <button id="clearPlaylist" class="clear-btn">√ó</button>
                <div id="playlistSuggestionsBox" class="suggestions-box"></div>
            </div>
        </div>
    </header>

    <div class="status-bar" id="statusBar"></div>

    <div id="loadingArea" class="loading">
        <div class="spinner"></div>
        <p>„É™„Çπ„Éà„ÇíË™≠„ÅøËæº„Çì„Åß„ÅÑ„Åæ„Åô...</p>
    </div>

    <div class="video-grid" id="videoGrid"></div>
    <div id="scrollSentinel"></div>
    
    <p class="no-result hidden" id="noResult">Êù°‰ª∂„Å´‰∏ÄËá¥„Åô„ÇãÂãïÁîª„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ</p>
</div>

<div id="detailPage">
    <div class="detail-header">
        <button class="back-btn" onclick="goBack()">
            <svg class="back-icon" viewBox="0 0 24 24">
                <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
            </svg>
            <span>‰∏ÄË¶ß„Å´Êàª„Çã</span>
        </button>
    </div>
    <div class="detail-content">
        <div class="video-container" id="detailEmbed"></div>
        <div class="detail-title" id="detailTitle"></div>
        
        <div class="action-bar">
            <button id="filterByPlaylistBtn" class="action-btn primary" style="display:none;">
                <svg viewBox="0 0 24 24"><path d="M10 18h4v-2h-4v2zM3 6v2h18V6H3zm3 7h12v-2H6v2z"/></svg>
                „Åì„ÅÆ„É™„Çπ„Éà„ÅßÁµû„ÇäËæº„Åø
            </button>
            <button onclick="copyVideoUrl()" class="action-btn">
                <svg viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
                URL„Çí„Ç≥„Éî„Éº
            </button>
        </div>

        <div class="detail-meta">
            <div class="detail-row">
                <span class="label">ÂãïÁîªURL:</span>
                <span class="value"><a href="#" id="detailUrl" target="_blank"></a></span>
            </div>
            <div class="detail-row">
                <span class="label">ÂÜçÁîü„É™„Çπ„Éà:</span>
                <span class="value" id="detailPlaylistContainer"></span>
            </div>
        </div>
    </div>
</div>

<script>
    const LIST_URL = "https://raw.githubusercontent.com/mokumokukairo/my-video-list/main/list.txt";

    document.addEventListener('contextmenu', e => e.preventDefault());
    document.addEventListener('keydown', e => {
        if (e.key === 'F12' || (e.ctrlKey && (e.key === 'u' || e.key === 'U'))) e.preventDefault();
    });
    
    function checkMaintenance() {
        const now = new Date();
        if (now.getHours() === 0 && now.getMinutes() < 20) {
            document.getElementById('mainView').style.display = 'none';
            document.getElementById('maintenanceScreen').style.display = 'flex';
            return true;
        }
        return false;
    }
    if (checkMaintenance()) throw new Error("Maintenance");

    const searchInput = document.getElementById('searchInput');
    const clearSearchBtn = document.getElementById('clearSearch');
    const suggestionsBox = document.getElementById('suggestionsBox');

    const playlistInput = document.getElementById('playlistSearchInput');
    const clearPlaylistBtn = document.getElementById('clearPlaylist');
    const playlistSuggestionsBox = document.getElementById('playlistSuggestionsBox');

    const videoGrid = document.getElementById('videoGrid');
    const loadingArea = document.getElementById('loadingArea');
    const statusBar = document.getElementById('statusBar');
    const scrollSentinel = document.getElementById('scrollSentinel');
    
    const detailPage = document.getElementById('detailPage');
    const mainView = document.getElementById('mainView');
    const detailEmbed = document.getElementById('detailEmbed');
    const detailTitle = document.getElementById('detailTitle');
    const detailUrl = document.getElementById('detailUrl');
    const detailPlaylistContainer = document.getElementById('detailPlaylistContainer');
    const filterByPlaylistBtn = document.getElementById('filterByPlaylistBtn');
    const copyToast = document.getElementById('copyToast');

    let allVideoData = []; 
    let currentFilteredData = [];
    let uniquePlaylists = [];
    let displayedCount = 0; 
    const BATCH_SIZE = 40; 
    const HISTORY_KEY = 'spchan_search_history';

    const observer = new IntersectionObserver((entries) => {
        if (entries[0].isIntersecting) {
            loadMoreVideos();
        }
    }, { rootMargin: '200px' });

    window.addEventListener('popstate', (event) => {
        if (detailPage.style.display === 'flex') {
            closeDetail(false);
        }
    });

    function getYouTubeID(url) {
        const match = url.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/);
        return (match && match[2].length === 11) ? match[2] : null;
    }

    async function fetchVideoList() {
        try {
            const response = await fetch(LIST_URL + '?t=' + Date.now());
            if (!response.ok) throw new Error();
            const text = await response.text();
            
            const rawData = new Function("return [" + text + "]")();
            
            const videoMap = new Map();
            rawData.forEach(v => {
                v.id = getYouTubeID(v.url);
                if (!v.id) return;
                const hasPlaylist = (v.playlist && v.playlist !== 'NA');
                if (!videoMap.has(v.id)) {
                    videoMap.set(v.id, v);
                } else {
                    const existing = videoMap.get(v.id);
                    if (hasPlaylist && (!existing.playlist || existing.playlist === 'NA')) {
                        videoMap.set(v.id, v);
                    }
                }
            });

            allVideoData = Array.from(videoMap.values());
            const playlistSet = new Set();
            allVideoData.forEach(v => {
                v.thumb = `https://i.ytimg.com/vi/${v.id}/mqdefault.jpg`;
                if (!v.playlist || v.playlist === 'NA') v.playlist = null;
                if (v.playlist) playlistSet.add(v.playlist);
            });
            uniquePlaylists = Array.from(playlistSet).sort();

            loadingArea.classList.add('hidden');
            searchInput.disabled = false;
            playlistInput.disabled = false;
            applyFilters(true);
        } catch (e) {
            console.error(e);
            loadingArea.innerHTML = "<p style='color:red'>„É™„Çπ„Éà„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ</p>";
        }
    }

    function renderVideoList(videos, reset = false) {
        if (reset) {
            videoGrid.innerHTML = '';
            displayedCount = 0;
            currentFilteredData = videos;
            window.scrollTo(0, 0);
            observer.disconnect();
        }

        const total = currentFilteredData.length;
        const nextLimit = Math.min(displayedCount + BATCH_SIZE, total);
        const videosToRender = currentFilteredData.slice(displayedCount, nextLimit);

        if (videosToRender.length === 0 && displayedCount === 0) {
            document.getElementById('noResult').classList.remove('hidden');
            statusBar.textContent = `0 ‰ª∂`;
            return;
        } else {
            document.getElementById('noResult').classList.add('hidden');
        }

        const fragment = document.createDocumentFragment();
        videosToRender.forEach(video => {
            const div = document.createElement('div');
            div.className = 'video-card';
            div.onclick = () => openDetail(video);

            const thumbSrc = video.thumb ? video.thumb : 'data:image/svg+xml,...';
            const playlistBadge = video.playlist ? `<div class="playlist-badge">üìÇ ${video.playlist}</div>` : '';

            div.innerHTML = `
                <div class="thumbnail-wrapper">
                    <img src="${thumbSrc}" alt="${video.title}" class="thumbnail-img" loading="lazy">
                </div>
                <div class="info">
                    <div class="title">${video.title}</div>
                    ${playlistBadge}
                    <div class="url-text">Ë©≥Á¥∞„ÇíË¶ã„Çã <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div>
                </div>
            `;
            fragment.appendChild(div);
        });

        videoGrid.appendChild(fragment);
        displayedCount = nextLimit;
        statusBar.textContent = `ÂÖ® ${allVideoData.length} ‰ª∂‰∏≠ ${total} ‰ª∂ (Ë°®Á§∫‰∏≠: ${displayedCount})`;

        if (displayedCount < total) {
            observer.observe(scrollSentinel);
        } else {
            observer.disconnect();
        }
    }

    function loadMoreVideos() {
        renderVideoList([], false);
    }

    let debounceTimer;
    function triggerFilter() {
        clearTimeout(debounceTimer);
        debounceTimer = setTimeout(() => applyFilters(), 300);
    }

    function applyFilters(immediate = false) {
        const titleKey = searchInput.value.toLowerCase().trim();
        const playlistKey = playlistInput.value.toLowerCase().trim();
        const titleWords = titleKey.split(/[\s„ÄÄ]+/).filter(k => k !== '');

        const filtered = allVideoData.filter(v => {
            const titleMatch = titleWords.every(w => v.title.toLowerCase().includes(w));
            const playlistMatch = playlistKey === '' || (v.playlist && v.playlist.toLowerCase().includes(playlistKey));
            return titleMatch && playlistMatch;
        });

        renderVideoList(filtered, true);
    }

    function openDetail(video) {
        history.pushState({ page: 'detail' }, '', '#detail');
        detailTitle.textContent = video.title;
        detailUrl.href = video.url;
        detailUrl.textContent = video.url;

        if (video.playlist) {
            let html = `<span>${video.playlist}</span>`;
            if (video.playlistUrl) {
                html += ` <a href="${video.playlistUrl}" target="_blank" class="ext-link">YouTube„ÅßÈñã„Åè ‚Üó</a>`;
            }
            detailPlaylistContainer.innerHTML = html;
            filterByPlaylistBtn.style.display = 'flex';
            filterByPlaylistBtn.onclick = () => {
                goBack();
                playlistInput.value = video.playlist;
                searchInput.value = '';
                updateClearBtn(searchInput, clearSearchBtn); 
                applyFilters(true);
            };
        } else {
            detailPlaylistContainer.textContent = "„Å™„Åó";
            filterByPlaylistBtn.style.display = 'none';
        }
        
        if (video.id) {
            detailEmbed.innerHTML = `<iframe src="https://www.youtube.com/embed/${video.id}?autoplay=1" allow="autoplay; encrypted-media" allowfullscreen></iframe>`;
        } else {
            detailEmbed.innerHTML = '<p style="color:#fff; text-align:center; padding-top:20%;">ÂãïÁîª„ÇíË™≠„ÅøËæº„ÇÅ„Åæ„Åõ„Çì</p>';
        }

        mainView.style.display = 'none';
        detailPage.style.display = 'flex';
        window.scrollTo(0, 0);
    }

    function goBack() {
        history.back();
    }

    function closeDetail(shouldBackHistory = true) {
        detailEmbed.innerHTML = '';
        detailPage.style.display = 'none';
        mainView.style.display = 'block';
    }

    function copyVideoUrl() {
        navigator.clipboard.writeText(detailUrl.href).then(() => {
            copyToast.classList.add('show');
            setTimeout(() => copyToast.classList.remove('show'), 2000);
        });
    }

    function saveHistory(keyword) {
        const trimmed = keyword.trim();
        if (!trimmed) return;
        
        let history = JSON.parse(localStorage.getItem(HISTORY_KEY) || '[]');
        history = history.filter(h => h !== trimmed);
        history.unshift(trimmed);
        if (history.length > 5) history.pop();
        localStorage.setItem(HISTORY_KEY, JSON.stringify(history));
    }

    function showSuggestionsBox(box, input) {
        box.style.display = 'block';
        input.classList.add('active');
    }
    
    function hideSuggestionsBox(box, input) {
        box.style.display = 'none';
        input.classList.remove('active');
    }

    function showHistory() {
        const history = JSON.parse(localStorage.getItem(HISTORY_KEY) || '[]');
        suggestionsBox.innerHTML = '';
        if (history.length === 0) {
            hideSuggestionsBox(suggestionsBox, searchInput);
            return;
        }

        history.forEach(h => {
            const div = document.createElement('div');
            div.className = 'suggestion-item';
            div.innerHTML = `<span class="icon">üïí</span> ${h}`;
            div.onclick = () => {
                searchInput.value = h;
                updateClearBtn(searchInput, clearSearchBtn);
                hideSuggestionsBox(suggestionsBox, searchInput);
                saveHistory(h); 
                applyFilters(true);
            };
            suggestionsBox.appendChild(div);
        });
        showSuggestionsBox(suggestionsBox, searchInput);
    }

    function updateTitleSuggestions(val) {
        const cleanVal = val.trim().toLowerCase();
        
        if (cleanVal === '') {
            showHistory();
            return;
        }

        suggestionsBox.innerHTML = '';
        const keywords = cleanVal.split(/[\s„ÄÄ]+/).filter(k => k !== '');
        const matches = allVideoData.filter(v => keywords.every(w => v.title.toLowerCase().includes(w)));
        const displayMatches = matches.slice(0, 10);
        
        if (displayMatches.length === 0) {
            hideSuggestionsBox(suggestionsBox, searchInput);
            return;
        }

        displayMatches.forEach(m => {
            const div = document.createElement('div');
            div.className = 'suggestion-item';
            div.innerHTML = `<span class="icon">üîç</span> ${m.title}`;
            div.onclick = () => {
                searchInput.value = m.title;
                updateClearBtn(searchInput, clearSearchBtn);
                hideSuggestionsBox(suggestionsBox, searchInput);
                saveHistory(m.title); 
                applyFilters(true);
            };
            suggestionsBox.appendChild(div);
        });
        showSuggestionsBox(suggestionsBox, searchInput);
    }

    function updatePlaylistSuggestions(val) {
        const cleanVal = val.toLowerCase().trim();
        playlistSuggestionsBox.innerHTML = '';
        let matches = uniquePlaylists;
        if (cleanVal !== '') {
            matches = uniquePlaylists.filter(p => p.toLowerCase().includes(cleanVal));
        }

        if (matches.length === 0) {
            hideSuggestionsBox(playlistSuggestionsBox, playlistInput);
            return;
        }

        matches.forEach(p => {
            const div = document.createElement('div');
            div.className = 'suggestion-item';
            div.innerHTML = `<span class="icon">üìÇ</span> ${p}`;
            div.onclick = () => {
                playlistInput.value = p;
                updateClearBtn(playlistInput, clearPlaylistBtn);
                hideSuggestionsBox(playlistSuggestionsBox, playlistInput);
                applyFilters(true);
            };
            playlistSuggestionsBox.appendChild(div);
        });
        showSuggestionsBox(playlistSuggestionsBox, playlistInput);
    }

    function updateClearBtn(input, btn) {
        if (input.value.length > 0) {
            btn.classList.add('visible');
        } else {
            btn.classList.remove('visible');
        }
    }

    function clearInput(input, btn, box) {
        input.value = '';
        input.focus(); 
        updateClearBtn(input, btn);
        hideSuggestionsBox(box, input); 
        applyFilters(true);
    }

    searchInput.addEventListener('focus', () => updateTitleSuggestions(searchInput.value));
    searchInput.addEventListener('click', () => updateTitleSuggestions(searchInput.value));
    searchInput.addEventListener('input', () => {
        triggerFilter();
        updateTitleSuggestions(searchInput.value);
        updateClearBtn(searchInput, clearSearchBtn);
    });
    searchInput.addEventListener('keydown', (e) => {
        if (e.isComposing) return;
        if (e.key === 'Enter') {
            e.preventDefault();
            hideSuggestionsBox(suggestionsBox, searchInput);
            searchInput.blur();
            saveHistory(searchInput.value);
            applyFilters(true);
        }
    });

    clearSearchBtn.addEventListener('click', () => {
        clearInput(searchInput, clearSearchBtn, suggestionsBox);
        showHistory();
    });

    playlistInput.addEventListener('focus', () => updatePlaylistSuggestions(playlistInput.value));
    playlistInput.addEventListener('click', () => updatePlaylistSuggestions(playlistInput.value));
    playlistInput.addEventListener('input', () => {
        triggerFilter();
        updatePlaylistSuggestions(playlistInput.value);
        updateClearBtn(playlistInput, clearPlaylistBtn);
    });
    playlistInput.addEventListener('keydown', (e) => {
        if (e.isComposing) return;
        if (e.key === 'Enter') {
            e.preventDefault();
            hideSuggestionsBox(playlistSuggestionsBox, playlistInput);
            playlistInput.blur();
            applyFilters(true);
        }
    });

    clearPlaylistBtn.addEventListener('click', () => {
        clearInput(playlistInput, clearPlaylistBtn, playlistSuggestionsBox);
        updatePlaylistSuggestions(''); 
    });

    document.addEventListener('click', e => {
        if (!searchInput.contains(e.target) && !suggestionsBox.contains(e.target) && !clearSearchBtn.contains(e.target)) {
            hideSuggestionsBox(suggestionsBox, searchInput);
        }
        if (!playlistInput.contains(e.target) && !playlistSuggestionsBox.contains(e.target) && !clearPlaylistBtn.contains(e.target)) {
            hideSuggestionsBox(playlistSuggestionsBox, playlistInput);
        }
    });

    fetchVideoList();
</script>

</body>

</html>
