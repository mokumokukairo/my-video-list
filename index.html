<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>ã‚¹ãƒãƒãƒ£ãƒ³å‹•ç”»ãƒ©ã‚¤ãƒ–ãƒ©ãƒª</title>
    <style>
        :root {
            --primary-color: #ff0000;
            --bg-color: #f9f9f9;
            --card-bg: #ffffff;
            --text-main: #0f0f0f;
            --text-sub: #606060;
            --highlight-bg: #f0f0f0;
            --playlist-badge-bg: #e5e5e5;
            --btn-bg: #f2f2f2;
            --menu-bg: #ffffff;
            --menu-text: #333;
        }

        body {
            font-family: Roboto, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0; padding: 0;
            overscroll-behavior-y: none;
        }

        .hidden { display: none !important; }

        #maintenanceScreen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #fff; z-index: 9999; display: none;
            flex-direction: column; justify-content: center; align-items: center; text-align: center;
        }
        .maint-icon { font-size: 4rem; margin-bottom: 20px; }

        header {
            background-color: var(--card-bg);
            padding: 15px 20px;
            position: sticky; top: 0; z-index: 1000;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: flex; flex-direction: column; align-items: center;
        }

        .header-top {
            display: flex; justify-content: center; align-items: center;
            width: 100%; position: relative; margin-bottom: 15px; height: 40px;
        }
        
        h1 { 
            font-size: 1.5rem; color: #333; margin: 0; 
            text-align: center; width: 100%;
        }

        .menu-btn {
            position: absolute; right: 0; top: 50%; transform: translateY(-50%);
            background: none; border: none; cursor: pointer; padding: 5px;
            display: flex; flex-direction: column; justify-content: space-around;
            width: 30px; height: 30px; z-index: 1001;
        }
        .menu-btn span {
            width: 100%; height: 3px; background-color: #333; border-radius: 2px;
        }

        .search-container {
            width: 100%; max-width: 800px;
            display: flex; flex-direction: column; gap: 10px;
        }

        .search-row {
            display: flex; gap: 8px; width: 100%; align-items: center;
        }

        .input-wrapper { 
            position: relative; width: 100%; z-index: 1; flex: 1;
        }
        .input-wrapper:focus-within { z-index: 10000; }
        
        input[type="text"], input[type="search"] {
            width: 100%; padding: 12px 45px 12px 20px;
            font-size: 16px;
            border: 1px solid #ccc; border-radius: 24px;
            box-sizing: border-box; background-color: #fff; transition: 0.2s;
            appearance: none; position: relative;
        }
        input:focus { outline: none; border-color: #1c62b9; box-shadow: 0 1px 6px rgba(32,33,36,0.28); }

        input[type="search"]::-webkit-search-cancel-button { -webkit-appearance: none; appearance: none; display: none; }

        .clear-btn {
            position: absolute; right: 5px; top: 50%; transform: translateY(-50%);
            width: 40px; height: 40px;
            border: none; background: transparent;
            font-size: 20px; color: #999; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            opacity: 0; pointer-events: none; transition: opacity 0.2s;
        }
        .clear-btn.visible { opacity: 1; pointer-events: auto; }
        .clear-btn:active { color: #333; }

        input.active {
            border-radius: 24px 24px 0 0 !important;
            border-bottom: 1px solid transparent !important;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1) !important;
        }

        .suggestions-box {
            position: absolute; top: 100%; left: 0; right: 0;
            background: #fff; 
            border: 1px solid #ccc; border-top: none;
            border-radius: 0 0 24px 24px; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: none; overflow-y: auto; max-height: 50vh;
            margin-top: -1px;
        }
        .suggestion-item { padding: 10px 15px; cursor: pointer; display: flex; align-items: center; font-size: 14px; border-bottom: 1px solid #f5f5f5; }
        .suggestion-item:hover { background-color: var(--highlight-bg); }
        .icon-sug { margin-right: 8px; color: var(--text-sub); }

        .reset-long-btn {
            background: var(--btn-bg); border: 1px solid #ccc;
            border-radius: 24px; padding: 0 16px; height: 44px;
            font-size: 0.85rem; cursor: pointer; color: #555;
            display: flex; align-items: center; gap: 6px;
            white-space: nowrap; flex-shrink: 0;
            transition: 0.2s;
        }
        .reset-long-btn:hover { background: #e0e0e0; color: #000; border-color: #bbb; }
        .reset-long-btn:active { transform: scale(0.98); }
        .reset-icon { width: 14px; height: 14px; stroke: currentColor; }

        .side-menu-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 20000;
            opacity: 0; pointer-events: none; transition: opacity 0.3s;
        }
        .side-menu-overlay.open { opacity: 1; pointer-events: auto; }

        .side-menu {
            position: absolute; top: 0; right: -300px; width: 280px; height: 100%;
            background: var(--menu-bg); box-shadow: -2px 0 5px rgba(0,0,0,0.1);
            transition: right 0.3s cubic-bezier(0.25, 1, 0.5, 1);
            overflow-y: auto; display: flex; flex-direction: column;
        }
        .side-menu-overlay.open .side-menu { right: 0; }

        .menu-header {
            padding: 20px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center;
        }
        .menu-title { font-weight: bold; font-size: 1.1rem; }
        .close-menu-btn { font-size: 24px; background: none; border: none; cursor: pointer; padding: 0 10px; }

        .menu-list { list-style: none; padding: 0; margin: 0; }
        .menu-list li { border-bottom: 1px solid #f5f5f5; }

        .menu-item {
            display: flex; justify-content: space-between; align-items: center; 
            width: 100%; padding: 15px 20px; text-align: left;
            background: none; border: none; font-size: 1rem; color: var(--menu-text);
            cursor: pointer; text-decoration: none; box-sizing: border-box;
            min-height: 54px;
        }
        .menu-item:hover { background-color: #f9f9f9; }
        .menu-version { font-size: 0.8rem; color: #888; }
        .menu-icon { font-size: 1.2rem; display: flex; align-items: center; justify-content: center; width: 24px; }

        .history-content {
            display: none; background: #fdfdfd; padding: 0; border-top: 1px solid #eee;
        }
        .history-content.show { display: block; }
        .history-item {
            padding: 12px 20px; border-bottom: 1px solid #eee; font-size: 0.9rem; line-height: 1.5;
        }
        .ver-badge {
            display: inline-block; background: #333; color: #fff; 
            font-size: 0.7rem; padding: 2px 6px; border-radius: 4px; margin-right: 5px;
        }
        .ver-desc { display: block; color: #555; margin-top: 4px; font-size: 0.85rem; }

        .status-bar { max-width: 1200px; margin: 10px auto 0; padding: 0 20px; text-align: right; font-size: 0.9rem; color: var(--text-sub); }
        .video-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px; padding: 20px; max-width: 1200px; margin: 0 auto;
        }
        .video-card {
            background: var(--card-bg); border-radius: 12px; overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); transition: 0.2s;
            cursor: pointer; display: flex; flex-direction: column;
            content-visibility: auto; contain-intrinsic-size: 300px;
        }
        .video-card:hover { transform: translateY(-4px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .thumbnail-wrapper { position: relative; width: 100%; padding-top: 56.25%; background: #eee; }
        .thumbnail-img { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; }
        .info { padding: 12px; flex-grow: 1; display: flex; flex-direction: column; justify-content: space-between; }
        .title {
            font-size: 1rem; font-weight: 600; line-height: 1.4; margin-bottom: 8px;
            display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;
        }
        .playlist-badge {
            display: inline-block; background-color: var(--playlist-badge-bg); color: #555;
            font-size: 0.75rem; padding: 2px 8px; border-radius: 4px; margin-bottom: 6px;
            align-self: flex-start; max-width: 100%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }
        .url-text { font-size: 0.75rem; color: var(--text-sub); display: flex; justify-content: flex-end; align-items: center; gap: 5px; }

        .sub-page {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #fff; z-index: 2000; overflow-y: auto;
            display: none; flex-direction: column;
        }
        .sub-header {
            padding: 10px 20px; background: #fff; border-bottom: 1px solid #eee;
            position: sticky; top: 0; z-index: 100; display: flex; align-items: center; height: 50px;
        }
        .back-btn {
            background: none; border: none; cursor: pointer;
            font-size: 1rem; color: #333; display: flex; align-items: center; gap: 8px;
            font-weight: 500; padding: 5px 10px; border-radius: 20px; transition: background 0.2s;
        }
        .back-btn:hover { background-color: #f0f0f0; }
        .back-icon { width: 24px; height: 24px; fill: currentColor; }

        .detail-content { max-width: 900px; width: 100%; margin: 0 auto; padding: 20px; box-sizing: border-box; }
        .video-container {
            position: relative; width: 100%; padding-top: 56.25%; background: #000; margin-bottom: 15px; border-radius: 12px; overflow: hidden;
        }
        .video-container iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; }
        .detail-title { font-size: 1.4rem; font-weight: bold; margin-bottom: 15px; line-height: 1.4; }
        .action-bar { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .action-btn {
            display: flex; align-items: center; gap: 6px;
            background-color: var(--btn-bg); color: #333;
            border: none; padding: 8px 16px; border-radius: 20px;
            cursor: pointer; font-size: 0.9rem; font-weight: 500; transition: 0.2s;
        }
        .action-btn:hover { background-color: #e0e0e0; }
        .action-btn svg { width: 18px; height: 18px; fill: currentColor; }
        .action-btn.primary { background-color: #333; color: #fff; }
        .action-btn.primary:hover { background-color: var(--primary-color); }
        .detail-meta { padding: 15px; background: #f9f9f9; border-radius: 8px; border: 1px solid #eee; }
        .detail-row { margin-bottom: 8px; display: flex; flex-wrap: wrap; gap: 10px; align-items: baseline; font-size: 0.95rem; }
        .label { font-weight: bold; color: #666; width: 100px; flex-shrink: 0; }
        .value { color: #333; word-break: break-all; flex: 1; }
        .value a { color: #0066cc; text-decoration: none; }
        .value a:hover { text-decoration: underline; }
        .ext-link { font-size: 0.85em; color: #666; margin-left: 5px; }

        .report-content {
            padding: 30px 20px; max-width: 600px; margin: 0 auto; text-align: center;
        }
        .report-icon-large { font-size: 4rem; margin-bottom: 20px; display: block; }
        .report-desc { text-align: left; line-height: 1.6; margin-bottom: 30px; color: #444; }
        .google-form-btn {
            display: inline-block; background-color: #673ab7; color: #fff;
            padding: 12px 24px; border-radius: 8px; text-decoration: none;
            font-weight: bold; box-shadow: 0 4px 6px rgba(103, 58, 183, 0.3);
            transition: 0.2s;
        }
        .google-form-btn:hover { background-color: #5e35b1; transform: translateY(-2px); box-shadow: 0 6px 12px rgba(103, 58, 183, 0.4); }

        #copyToast {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            background: rgba(0,0,0,0.8); color: white; padding: 10px 20px;
            border-radius: 30px; font-size: 14px; z-index: 3000;
            opacity: 0; transition: opacity 0.3s; pointer-events: none;
        }
        #copyToast.show { opacity: 1; }
        .loading, .no-result { text-align: center; margin-top: 50px; color: var(--text-sub); width: 100%; }
        .spinner {
            border: 4px solid #f3f3f3; border-top: 4px solid var(--primary-color);
            border-radius: 50%; width: 40px; height: 40px;
            animation: spin 1s linear infinite; margin: 20px auto;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        #scrollSentinel { height: 50px; width: 100%; }
    </style>
</head>
<body>

<div id="maintenanceScreen">
    <div class="maint-icon">ğŸ”§</div>
    <h2>ã‚·ã‚¹ãƒ†ãƒ ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ä¸­</h2>
    <p>æ¯æ—¥ 0:00 ã€œ 0:20 ã®é–“ã¯ã”åˆ©ç”¨ã„ãŸã ã‘ã¾ã›ã‚“ã€‚</p>
</div>
<div id="copyToast">URLã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ</div>

<div id="aboutModal" class="side-menu-overlay" style="z-index: 30000; display:flex; align-items:center; justify-content:center;">
    <div style="background:#fff; width:90%; max-width:500px; max-height:80vh; border-radius:12px; padding:20px; overflow-y:auto; position:relative; box-shadow:0 10px 25px rgba(0,0,0,0.2);">
        <button id="closeAboutBtn" style="position:absolute; right:15px; top:15px; background:none; border:none; font-size:24px; cursor:pointer;">Ã—</button>
        <h3 style="margin-top:0; border-bottom:2px solid #eee; padding-bottom:10px;">ã“ã®ã‚µã‚¤ãƒˆã«ã¤ã„ã¦</h3>
        <div style="font-size:0.95rem; line-height:1.6; color:#444;">
            <p><strong>ã‚¹ãƒãƒãƒ£ãƒ³å‹•ç”»æ¤œç´¢ (Unofficial)</strong></p>
            <p>YouTubeã®ã€Œã‚¹ãƒãƒ¼ãƒ„ãƒãƒ£ãƒ³ãƒãƒ©ã€å…¬å¼ãƒãƒ£ãƒ³ãƒãƒ«ã®å‹•ç”»ã‚’ã€ã‚¿ã‚¤ãƒˆãƒ«ã‚„å†ç”Ÿãƒªã‚¹ãƒˆã‹ã‚‰é«˜é€Ÿã«æ¤œç´¢ãƒ»è¦–è´ã§ãã‚‹éå…¬å¼ãƒ•ã‚¡ãƒ³ã‚µã‚¤ãƒˆã§ã™ã€‚</p>
            
            <p><strong>ğŸ” ä½¿ã„æ–¹</strong></p>
            <ul style="padding-left:20px; margin:10px 0;">
                <li><strong>ä¸Šã®çª“ï¼š</strong>å‹•ç”»ã‚¿ã‚¤ãƒˆãƒ«ã§æ¤œç´¢ã§ãã¾ã™ï¼ˆä¾‹ï¼šã€Œå¤§ä¼šã€ã€Œæ±ºå‹ã€ï¼‰ã€‚</li>
                <li><strong>ä¸‹ã®çª“ï¼š</strong>å†ç”Ÿãƒªã‚¹ãƒˆï¼ˆå¤§ä¼šåãªã©ï¼‰ã§çµã‚Šè¾¼ã‚ã¾ã™ã€‚</li>
                <li><strong>ãƒªã‚»ãƒƒãƒˆï¼š</strong>å…¥åŠ›çª“ã®æ¨ªã®ã€Œå…¥åŠ›å†…å®¹ã‚’å…¨ã¦ãƒªã‚»ãƒƒãƒˆã€ã§ã‚¯ãƒªã‚¢ã—ã¾ã™ã€‚</li>
            </ul>

            <p style="font-size:0.85rem; background:#f0f0f0; padding:10px; border-radius:6px;">
                â€»æœ¬ã‚µã‚¤ãƒˆã¯æœ‰å¿—ã«ã‚ˆã‚‹é‹å–¶ã§ã‚ã‚Šã€(å…¬ç¤¾)æ—¥æœ¬ã‚¹ãƒãƒ¼ãƒ„ãƒãƒ£ãƒ³ãƒãƒ©å”ä¼šã¨ã¯ç„¡é–¢ä¿‚ã§ã™ã€‚<br>
                â€»å‹•ç”»ã®è‘—ä½œæ¨©ã¯å…ƒã®ãƒãƒ£ãƒ³ãƒãƒ«ä¸»ã«å¸°å±ã—ã¾ã™ã€‚
            </p>
        </div>
    </div>
</div>

<div id="sideMenuOverlay" class="side-menu-overlay">
    <div class="side-menu">
        <div class="menu-header">
            <span class="menu-title">MENU</span>
            <button id="closeMenuBtn" class="close-menu-btn">Ã—</button>
        </div>
        <ul class="menu-list">
            <li>
                <button class="menu-item" id="toggleHistoryBtn">
                    <span>æ›´æ–°å±¥æ­´</span>
                    <span class="menu-version" id="currentVerDisplay">Ver 1.13</span>
                </button>
                <div id="historyContent" class="history-content">
                    </div>
            </li>
            <li>
                <button class="menu-item" id="aboutBtn">
                    <span>ä½¿ã„æ–¹ãƒ»ã“ã®ã‚µã‚¤ãƒˆã«ã¤ã„ã¦</span>
                    <span class="menu-icon">â„¹ï¸</span>
                </button>
            </li>
            <li>
                <a href="https://www.youtube.com/@sports-chanbara" target="_blank" class="menu-item">
                    <span>YouTubeå…¬å¼ãƒãƒ£ãƒ³ãƒãƒ«</span>
                    <span class="menu-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg>
                    </span>
                </a>
            </li>
            <li>
                <button class="menu-item" id="bugReportNavBtn">
                    <span>ãƒã‚°ãƒ»ä¸å…·åˆå ±å‘Š</span>
                    <span class="menu-icon">ğŸ“®</span>
                </button>
            </li>
            <li>
                <button class="menu-item" onclick="clearAllHistory()">
                    <span>æ¤œç´¢å±¥æ­´ã‚’å‰Šé™¤</span>
                </button>
            </li>
        </ul>
        <div style="padding:20px; font-size:0.8rem; color:#999; text-align:center; margin-top:auto;">
            Unofficial Video Library<br>Ver 1.13
        </div>
    </div>
</div>

<div id="mainView">
    <header>
        <div class="header-top">
            <h1>ã‚¹ãƒãƒãƒ£ãƒ³å‹•ç”»æ¤œç´¢</h1>
            <button id="hamburgerBtn" class="menu-btn" aria-label="ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‹ã">
                <span></span><span></span><span></span>
            </button>
        </div>
        
        <div class="search-container">
            <div class="input-wrapper">
                <input type="search" id="searchInput" placeholder="å‹•ç”»ã‚¿ã‚¤ãƒˆãƒ«ã‚’æ¤œç´¢..." disabled autocomplete="off" name="search_q_uniq" enterkeyhint="search">
                <button id="clearSearch" class="clear-btn">Ã—</button>
                <div id="suggestionsBox" class="suggestions-box"></div>
            </div>
            
            <div class="search-row">
                <div class="input-wrapper">
                    <input type="search" id="playlistSearchInput" placeholder="ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã§çµã‚Šè¾¼ã¿..." disabled autocomplete="off" name="search_p_uniq" enterkeyhint="search">
                    <button id="clearPlaylist" class="clear-btn">Ã—</button>
                    <div id="playlistSuggestionsBox" class="suggestions-box"></div>
                </div>
                <button id="resetAllBtn" class="reset-long-btn" title="å…¨ã¦ã®å…¥åŠ›ã‚’ã‚¯ãƒªã‚¢">
                    <svg class="reset-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>
                    å…¥åŠ›å†…å®¹ã‚’å…¨ã¦ãƒªã‚»ãƒƒãƒˆ
                </button>
            </div>
        </div>
    </header>

    <div class="status-bar" id="statusBar"></div>

    <div id="loadingArea" class="loading">
        <div class="spinner"></div>
        <p>ãƒªã‚¹ãƒˆã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...</p>
    </div>

    <div class="video-grid" id="videoGrid"></div>
    <div id="scrollSentinel"></div>
    
    <p class="no-result hidden" id="noResult">æ¡ä»¶ã«ä¸€è‡´ã™ã‚‹å‹•ç”»ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</p>
</div>

<div id="detailPage" class="sub-page">
    <div class="sub-header">
        <button class="back-btn" onclick="goBack()">
            <svg class="back-icon" viewBox="0 0 24 24">
                <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
            </svg>
            <span>ä¸€è¦§ã«æˆ»ã‚‹</span>
        </button>
    </div>
    <div class="detail-content">
        <div class="video-container" id="detailEmbed"></div>
        <div class="detail-title" id="detailTitle"></div>
        
        <div class="action-bar">
            <button id="filterByPlaylistBtn" class="action-btn primary" style="display:none;">
                <svg viewBox="0 0 24 24"><path d="M10 18h4v-2h-4v2zM3 6v2h18V6H3zm3 7h12v-2H6v2z"/></svg>
                ã“ã®ãƒªã‚¹ãƒˆã§çµã‚Šè¾¼ã¿
            </button>
            <button onclick="copyVideoUrl()" class="action-btn">
                <svg viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
                URLã‚’ã‚³ãƒ”ãƒ¼
            </button>
        </div>

        <div class="detail-meta">
            <div class="detail-row">
                <span class="label">å‹•ç”»URL:</span>
                <span class="value"><a href="#" id="detailUrl" target="_blank"></a></span>
            </div>
            <div class="detail-row">
                <span class="label">å†ç”Ÿãƒªã‚¹ãƒˆ:</span>
                <span class="value" id="detailPlaylistContainer"></span>
            </div>
        </div>
    </div>
</div>

<div id="bugReportPage" class="sub-page">
    <div class="sub-header">
        <button class="back-btn" onclick="closeBugReport()">
            <svg class="back-icon" viewBox="0 0 24 24">
                <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
            </svg>
            <span>ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</span>
        </button>
    </div>
    <div class="report-content">
        <span class="report-icon-large">ğŸ“®</span>
        <h2>ãƒã‚°ãƒ»ä¸å…·åˆå ±å‘Š</h2>
        <div class="report-desc">
            <p>ã‚µã‚¤ãƒˆã®ã”åˆ©ç”¨ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚<br>æ¤œç´¢ãŒã§ããªã„ã€è¡¨ç¤ºãŒå´©ã‚Œã¦ã„ã‚‹ãªã©ã®ä¸å…·åˆã‚’è¦‹ã¤ã‘ãŸå ´åˆã¯ã€ä»¥ä¸‹ã®ãƒ•ã‚©ãƒ¼ãƒ ã‚ˆã‚Šã”å ±å‘Šã„ãŸã ã‘ã¾ã™ã¨å¹¸ã„ã§ã™ã€‚</p>
            <p>â€»æ©Ÿèƒ½ã®è¿½åŠ è¦æœ›ãªã©ã‚‚ã“ã¡ã‚‰ã§å—ã‘ä»˜ã‘ã¦ã„ã¾ã™ã€‚</p>
        </div>
        
        <a href="https://forms.gle/wGQGhcBa8yRvFWBEA" target="_blank" class="google-form-btn">
            Googleãƒ•ã‚©ãƒ¼ãƒ ã§å ±å‘Šã™ã‚‹ â†—
        </a>
    </div>
</div>

<script>

    const LIST_URL = "https://raw.githubusercontent.com/mokumokukairo/my-video-list/main/list.txt";

    document.addEventListener('contextmenu', e => e.preventDefault());
    document.addEventListener('keydown', e => {
        if (e.key === 'F12' || (e.ctrlKey && (e.key === 'u' || e.key === 'U'))) e.preventDefault();
    });
    
    function checkMaintenance() {
        const now = new Date();
        if (now.getHours() === 0 && now.getMinutes() < 20) {
            document.getElementById('mainView').style.display = 'none';
            document.getElementById('maintenanceScreen').style.display = 'flex';
            return true;
        }
        return false;
    }
    if (checkMaintenance()) throw new Error("Maintenance");

    const searchInput = document.getElementById('searchInput');
    const clearSearchBtn = document.getElementById('clearSearch');
    const suggestionsBox = document.getElementById('suggestionsBox');
    const playlistInput = document.getElementById('playlistSearchInput');
    const clearPlaylistBtn = document.getElementById('clearPlaylist');
    const playlistSuggestionsBox = document.getElementById('playlistSuggestionsBox');
    const videoGrid = document.getElementById('videoGrid');
    const loadingArea = document.getElementById('loadingArea');
    const statusBar = document.getElementById('statusBar');
    const scrollSentinel = document.getElementById('scrollSentinel');
    
    const detailPage = document.getElementById('detailPage');
    const bugReportPage = document.getElementById('bugReportPage');
    const mainView = document.getElementById('mainView');
    
    const detailEmbed = document.getElementById('detailEmbed');
    const detailTitle = document.getElementById('detailTitle');
    const detailUrl = document.getElementById('detailUrl');
    const detailPlaylistContainer = document.getElementById('detailPlaylistContainer');
    const filterByPlaylistBtn = document.getElementById('filterByPlaylistBtn');
    const copyToast = document.getElementById('copyToast');

    const hamburgerBtn = document.getElementById('hamburgerBtn');
    const sideMenuOverlay = document.getElementById('sideMenuOverlay');
    const closeMenuBtn = document.getElementById('closeMenuBtn');
    const toggleHistoryBtn = document.getElementById('toggleHistoryBtn');
    const historyContent = document.getElementById('historyContent');
    const resetAllBtn = document.getElementById('resetAllBtn');
    
    const bugReportNavBtn = document.getElementById('bugReportNavBtn');

    let allVideoData = []; 
    let currentFilteredData = [];
    let uniquePlaylists = [];
    let displayedCount = 0; 
    const BATCH_SIZE = 40; 
    const HISTORY_KEY = 'spchan_search_history';

    const updateHistory = [
        { ver: "1.13", desc: "ã‚¿ã‚¤ãƒˆãƒ«å†é…ç½®ã€ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³é…ç½®å¤‰æ›´ã€ã‚¢ã‚¤ã‚³ãƒ³ãƒ‡ã‚¶ã‚¤ãƒ³åˆ·æ–°" },
        { ver: "1.12", desc: "ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ã®å®Ÿè£…ã€ãƒã‚°å ±å‘Šãƒšãƒ¼ã‚¸ã®è¿½åŠ , è»½å¾®ãªãƒã‚°ã®ä¿®æ­£" },
        { ver: "1.11", desc: "ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã€æ›´æ–°å±¥æ­´ã€æ©Ÿèƒ½ãƒªãƒ³ã‚¯ã®å®Ÿè£…, è»½å¾®ãªãƒã‚°ã®ä¿®æ­£" },
        { ver: "1.10", desc: "è‡ªå‹•æ›´æ–°æ™‚åˆ»ã‚’æ—¥æœ¬æ™‚é–“ã®0:00ã«å¤‰æ›´, è»½å¾®ãªãƒã‚°ã®ä¿®æ­£" },
        { ver: "1.09", desc: "ã‚¹ãƒãƒ›ã§ã®æ¤œç´¢çª“é‡ãªã‚Šä¸å…·åˆã®ä¿®æ­£" },
        { ver: "1.08", desc: "æ¤œç´¢ã‚¯ãƒªã‚¢ãƒœã‚¿ãƒ³ã®å¤§å‹åŒ–ã¨æ“ä½œæ€§å‘ä¸Š, è»½å¾®ãªãƒã‚°ã®ä¿®æ­£" },
        { ver: "1.07", desc: "æ¤œç´¢çª“ã®ãƒ‡ã‚¶ã‚¤ãƒ³ä¿®æ­£, è»½å¾®ãªãƒã‚°ã®ä¿®æ­£" },
        { ver: "1.06", desc: "ã‚¹ãƒãƒ›å…¥åŠ›æœ€é©åŒ–ã¨å±¥æ­´ä¿å­˜ãƒ­ã‚¸ãƒƒã‚¯å¤‰æ›´" },
        { ver: "1.05", desc: "æ¤œç´¢å±¥æ­´æ©Ÿèƒ½ã®å®Ÿè£…, è»½å¾®ãªãƒã‚°ã®ä¿®æ­£" },
        { ver: "1.04", desc: "é–‹ç™ºãƒ•ãƒ­ãƒ¼æ¡ˆå†…ã®ç¢ºç«‹" },
        { ver: "1.03", desc: "å…¨å‹•ç”»ã¨ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã®çµ±åˆå–å¾—ã€é‡è¤‡å‡¦ç†ãƒ­ã‚¸ãƒƒã‚¯è¿½åŠ " },
        { ver: "1.02", desc: "ç„¡é™ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å®Ÿè£…ã€Enterã‚­ãƒ¼æŒ™å‹•ä¿®æ­£ã€æœªåˆ†é¡å‹•ç”»å–å¾—æ¼ã‚Œä¿®æ­£, è»½å¾®ãªãƒã‚°ã®ä¿®æ­£" },
        { ver: "1.01", desc: "ã‚µã‚¤ãƒˆè»½é‡åŒ–å¯¾å¿œ, è»½å¾®ãªãƒã‚°ã®ä¿®æ­£" }
    ];

    function initMenu() {
        historyContent.innerHTML = updateHistory.map(h => `
            <div class="history-item">
                <span class="ver-badge">Ver ${h.ver}</span>
                <span class="ver-desc">${h.desc}</span>
            </div>
        `).join('');

        hamburgerBtn.addEventListener('click', () => sideMenuOverlay.classList.add('open'));
        closeMenuBtn.addEventListener('click', () => sideMenuOverlay.classList.remove('open'));
        sideMenuOverlay.addEventListener('click', (e) => {
            if (e.target === sideMenuOverlay) sideMenuOverlay.classList.remove('open');
        });

        toggleHistoryBtn.addEventListener('click', () => {
            historyContent.classList.toggle('show');
        });
        
        bugReportNavBtn.addEventListener('click', () => {
            sideMenuOverlay.classList.remove('open'); 
            openBugReport();
        });
    }

    function clearAllHistory() {
        if(confirm("ä¿å­˜ã•ã‚Œã¦ã„ã‚‹æ¤œç´¢å±¥æ­´ã‚’ã™ã¹ã¦å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) {
            localStorage.removeItem(HISTORY_KEY);
            alert("å±¥æ­´ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚");
            sideMenuOverlay.classList.remove('open');
        }
    }

    const aboutBtn = document.getElementById('aboutBtn');
    const aboutModal = document.getElementById('aboutModal');
    const closeAboutBtn = document.getElementById('closeAboutBtn');

    aboutModal.style.display = 'none';

    aboutBtn.addEventListener('click', () => {
        aboutModal.style.display = 'flex';
        setTimeout(() => aboutModal.classList.add('open'), 10);
        sideMenuOverlay.classList.remove('open');
    });

    closeAboutBtn.addEventListener('click', () => {
        aboutModal.classList.remove('open');
        setTimeout(() => aboutModal.style.display = 'none', 300);
    });

    aboutModal.addEventListener('click', (e) => {
        if (e.target === aboutModal) {
            aboutModal.classList.remove('open');
            setTimeout(() => aboutModal.style.display = 'none', 300);
        }
    });

    initMenu();

    const observer = new IntersectionObserver((entries) => {
        if (entries[0].isIntersecting) {
            loadMoreVideos();
        }
    }, { rootMargin: '200px' });

    window.addEventListener('popstate', (event) => {
        if (detailPage.style.display === 'flex') {
            closeDetail(false);
        } else if (bugReportPage.style.display === 'flex') {
            closeBugReport(false);
        }
    });

    function getYouTubeID(url) {
        const match = url.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/);
        return (match && match[2].length === 11) ? match[2] : null;
    }

    async function fetchVideoList() {
        try {
            const response = await fetch(LIST_URL + '?t=' + Date.now());
            if (!response.ok) throw new Error();
            const text = await response.text();
            
            const rawData = new Function("return [" + text + "]")();
            
            const videoMap = new Map();
            rawData.forEach(v => {
                v.id = getYouTubeID(v.url);
                if (!v.id) return;
                const hasPlaylist = (v.playlist && v.playlist !== 'NA');
                if (!videoMap.has(v.id)) {
                    videoMap.set(v.id, v);
                } else {
                    const existing = videoMap.get(v.id);
                    if (hasPlaylist && (!existing.playlist || existing.playlist === 'NA')) {
                        videoMap.set(v.id, v);
                    }
                }
            });

            allVideoData = Array.from(videoMap.values());
            const playlistSet = new Set();
            allVideoData.forEach(v => {
                v.thumb = `https://i.ytimg.com/vi/${v.id}/mqdefault.jpg`;
                if (!v.playlist || v.playlist === 'NA') v.playlist = null;
                if (v.playlist) playlistSet.add(v.playlist);
            });
            uniquePlaylists = Array.from(playlistSet).sort();

            loadingArea.classList.add('hidden');
            searchInput.disabled = false;
            playlistInput.disabled = false;
            applyFilters(true);
        } catch (e) {
            console.error(e);
            loadingArea.innerHTML = "<p style='color:red'>ãƒªã‚¹ãƒˆã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚</p>";
        }
    }

    function renderVideoList(videos, reset = false) {
        if (reset) {
            videoGrid.innerHTML = '';
            displayedCount = 0;
            currentFilteredData = videos;
            window.scrollTo(0, 0);
            observer.disconnect();
        }

        const total = currentFilteredData.length;
        const nextLimit = Math.min(displayedCount + BATCH_SIZE, total);
        const videosToRender = currentFilteredData.slice(displayedCount, nextLimit);

        if (videosToRender.length === 0 && displayedCount === 0) {
            document.getElementById('noResult').classList.remove('hidden');
            statusBar.textContent = `0 ä»¶`;
            return;
        } else {
            document.getElementById('noResult').classList.add('hidden');
        }

        const fragment = document.createDocumentFragment();
        videosToRender.forEach(video => {
            const div = document.createElement('div');
            div.className = 'video-card';
            div.onclick = () => openDetail(video);

            const thumbSrc = video.thumb ? video.thumb : 'data:image/svg+xml,...';
            const playlistBadge = video.playlist ? `<div class="playlist-badge">ğŸ“‚ ${video.playlist}</div>` : '';

            div.innerHTML = `
                <div class="thumbnail-wrapper">
                    <img src="${thumbSrc}" alt="${video.title}" class="thumbnail-img" loading="lazy">
                </div>
                <div class="info">
                    <div class="title">${video.title}</div>
                    ${playlistBadge}
                    <div class="url-text">è©³ç´°ã‚’è¦‹ã‚‹ <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div>
                </div>
            `;
            fragment.appendChild(div);
        });

        videoGrid.appendChild(fragment);
        displayedCount = nextLimit;
        statusBar.textContent = `å…¨ ${allVideoData.length} ä»¶ä¸­ ${total} ä»¶ (è¡¨ç¤ºä¸­: ${displayedCount})`;

        if (displayedCount < total) {
            observer.observe(scrollSentinel);
        } else {
            observer.disconnect();
        }
    }

    function loadMoreVideos() {
        renderVideoList([], false);
    }

    let debounceTimer;
    function triggerFilter() {
        clearTimeout(debounceTimer);
        debounceTimer = setTimeout(() => applyFilters(), 300);
    }

    function applyFilters(immediate = false) {
        const titleKey = searchInput.value.toLowerCase().trim();
        const playlistKey = playlistInput.value.toLowerCase().trim();
        const titleWords = titleKey.split(/[\sã€€]+/).filter(k => k !== '');

        const filtered = allVideoData.filter(v => {
            const titleMatch = titleWords.every(w => v.title.toLowerCase().includes(w));
            const playlistMatch = playlistKey === '' || (v.playlist && v.playlist.toLowerCase().includes(playlistKey));
            return titleMatch && playlistMatch;
        });

        renderVideoList(filtered, true);
    }

    function openDetail(video) {
        history.pushState({ page: 'detail' }, '', '#detail');
        detailTitle.textContent = video.title;
        detailUrl.href = video.url;
        detailUrl.textContent = video.url;

        if (video.playlist) {
            let html = `<span>${video.playlist}</span>`;
            if (video.playlistUrl) {
                html += ` <a href="${video.playlistUrl}" target="_blank" class="ext-link">YouTubeã§é–‹ã â†—</a>`;
            }
            detailPlaylistContainer.innerHTML = html;
            filterByPlaylistBtn.style.display = 'flex';
            filterByPlaylistBtn.onclick = () => {
                goBack();
                playlistInput.value = video.playlist;
                searchInput.value = '';
                updateClearBtn(searchInput, clearSearchBtn); 
                applyFilters(true);
            };
        } else {
            detailPlaylistContainer.textContent = "ãªã—";
            filterByPlaylistBtn.style.display = 'none';
        }
        
        if (video.id) {
            detailEmbed.innerHTML = `<iframe src="https://www.youtube.com/embed/${video.id}?autoplay=1" allow="autoplay; encrypted-media" allowfullscreen></iframe>`;
        } else {
            detailEmbed.innerHTML = '<p style="color:#fff; text-align:center; padding-top:20%;">å‹•ç”»ã‚’èª­ã¿è¾¼ã‚ã¾ã›ã‚“</p>';
        }

        mainView.style.display = 'none';
        detailPage.style.display = 'flex';
        window.scrollTo(0, 0);
    }

    function goBack() {
        history.back();
    }

    function closeDetail(shouldBackHistory = true) {
        detailEmbed.innerHTML = '';
        detailPage.style.display = 'none';
        mainView.style.display = 'block';
    }

    // --- ãƒã‚°å ±å‘Šãƒšãƒ¼ã‚¸åˆ¶å¾¡ ---
    function openBugReport() {
        history.pushState({ page: 'bugreport' }, '', '#bugreport');
        mainView.style.display = 'none';
        bugReportPage.style.display = 'flex';
        window.scrollTo(0, 0);
    }

    function closeBugReport(shouldBackHistory = true) {
        if(shouldBackHistory) history.back();
        bugReportPage.style.display = 'none';
        mainView.style.display = 'block';
    }


    function copyVideoUrl() {
        navigator.clipboard.writeText(detailUrl.href).then(() => {
            copyToast.classList.add('show');
            setTimeout(() => copyToast.classList.remove('show'), 2000);
        });
    }

    function saveHistory(keyword) {
        const trimmed = keyword.trim();
        if (!trimmed) return;
        
        let history = JSON.parse(localStorage.getItem(HISTORY_KEY) || '[]');
        history = history.filter(h => h !== trimmed);
        history.unshift(trimmed);
        if (history.length > 5) history.pop();
        localStorage.setItem(HISTORY_KEY, JSON.stringify(history));
    }

    function showSuggestionsBox(box, input) {
        box.style.display = 'block';
        input.classList.add('active');
    }
    
    function hideSuggestionsBox(box, input) {
        box.style.display = 'none';
        input.classList.remove('active');
    }

    function showHistory() {
        const history = JSON.parse(localStorage.getItem(HISTORY_KEY) || '[]');
        suggestionsBox.innerHTML = '';
        if (history.length === 0) {
            hideSuggestionsBox(suggestionsBox, searchInput);
            return;
        }

        history.forEach(h => {
            const div = document.createElement('div');
            div.className = 'suggestion-item';
            div.innerHTML = `<span class="icon-sug">ğŸ•’</span> ${h}`;
            div.onclick = () => {
                searchInput.value = h;
                updateClearBtn(searchInput, clearSearchBtn);
                hideSuggestionsBox(suggestionsBox, searchInput);
                saveHistory(h); 
                applyFilters(true);
            };
            suggestionsBox.appendChild(div);
        });
        showSuggestionsBox(suggestionsBox, searchInput);
    }

    function updateTitleSuggestions(val) {
        const cleanVal = val.trim().toLowerCase();
        
        if (cleanVal === '') {
            showHistory();
            return;
        }

        suggestionsBox.innerHTML = '';
        const keywords = cleanVal.split(/[\sã€€]+/).filter(k => k !== '');
        const matches = allVideoData.filter(v => keywords.every(w => v.title.toLowerCase().includes(w)));
        const displayMatches = matches.slice(0, 10);
        
        if (displayMatches.length === 0) {
            hideSuggestionsBox(suggestionsBox, searchInput);
            return;
        }

        displayMatches.forEach(m => {
            const div = document.createElement('div');
            div.className = 'suggestion-item';
            div.innerHTML = `<span class="icon-sug">ğŸ”</span> ${m.title}`;
            div.onclick = () => {
                searchInput.value = m.title;
                updateClearBtn(searchInput, clearSearchBtn);
                hideSuggestionsBox(suggestionsBox, searchInput);
                saveHistory(m.title); 
                applyFilters(true);
            };
            suggestionsBox.appendChild(div);
        });
        showSuggestionsBox(suggestionsBox, searchInput);
    }

    function updatePlaylistSuggestions(val) {
        const cleanVal = val.toLowerCase().trim();
        playlistSuggestionsBox.innerHTML = '';
        let matches = uniquePlaylists;
        if (cleanVal !== '') {
            matches = uniquePlaylists.filter(p => p.toLowerCase().includes(cleanVal));
        }

        if (matches.length === 0) {
            hideSuggestionsBox(playlistSuggestionsBox, playlistInput);
            return;
        }

        matches.forEach(p => {
            const div = document.createElement('div');
            div.className = 'suggestion-item';
            div.innerHTML = `<span class="icon-sug">ğŸ“‚</span> ${p}`;
            div.onclick = () => {
                playlistInput.value = p;
                updateClearBtn(playlistInput, clearPlaylistBtn);
                hideSuggestionsBox(playlistSuggestionsBox, playlistInput);
                applyFilters(true);
            };
            playlistSuggestionsBox.appendChild(div);
        });
        showSuggestionsBox(playlistSuggestionsBox, playlistInput);
    }

    function updateClearBtn(input, btn) {
        if (input.value.length > 0) {
            btn.classList.add('visible');
        } else {
            btn.classList.remove('visible');
        }
    }

    function clearInput(input, btn, box) {
        input.value = '';
        input.focus(); 
        updateClearBtn(input, btn);
        hideSuggestionsBox(box, input); 
        applyFilters(true);
    }

    resetAllBtn.addEventListener('click', () => {
        searchInput.value = '';
        playlistInput.value = '';
        updateClearBtn(searchInput, clearSearchBtn);
        updateClearBtn(playlistInput, clearPlaylistBtn);
        hideSuggestionsBox(suggestionsBox, searchInput);
        hideSuggestionsBox(playlistSuggestionsBox, playlistInput);
        applyFilters(true);
    });

    searchInput.addEventListener('focus', () => updateTitleSuggestions(searchInput.value));
    searchInput.addEventListener('click', () => updateTitleSuggestions(searchInput.value));
    searchInput.addEventListener('input', () => {
        triggerFilter();
        updateTitleSuggestions(searchInput.value);
        updateClearBtn(searchInput, clearSearchBtn);
    });
    searchInput.addEventListener('keydown', (e) => {
        if (e.isComposing) return;
        if (e.key === 'Enter') {
            e.preventDefault();
            hideSuggestionsBox(suggestionsBox, searchInput);
            searchInput.blur();
            saveHistory(searchInput.value);
            applyFilters(true);
        }
    });

    clearSearchBtn.addEventListener('click', () => {
        clearInput(searchInput, clearSearchBtn, suggestionsBox);
        showHistory();
    });

    playlistInput.addEventListener('focus', () => updatePlaylistSuggestions(playlistInput.value));
    playlistInput.addEventListener('click', () => updatePlaylistSuggestions(playlistInput.value));
    playlistInput.addEventListener('input', () => {
        triggerFilter();
        updatePlaylistSuggestions(playlistInput.value);
        updateClearBtn(playlistInput, clearPlaylistBtn);
    });
    playlistInput.addEventListener('keydown', (e) => {
        if (e.isComposing) return;
        if (e.key === 'Enter') {
            e.preventDefault();
            hideSuggestionsBox(playlistSuggestionsBox, playlistInput);
            playlistInput.blur();
            applyFilters(true);
        }
    });

    clearPlaylistBtn.addEventListener('click', () => {
        clearInput(playlistInput, clearPlaylistBtn, playlistSuggestionsBox);
        updatePlaylistSuggestions(''); 
    });

    document.addEventListener('click', e => {
        if (!searchInput.contains(e.target) && !suggestionsBox.contains(e.target) && !clearSearchBtn.contains(e.target)) {
            hideSuggestionsBox(suggestionsBox, searchInput);
        }
        if (!playlistInput.contains(e.target) && !playlistSuggestionsBox.contains(e.target) && !clearPlaylistBtn.contains(e.target)) {
            hideSuggestionsBox(playlistSuggestionsBox, playlistInput);
        }
    });

    fetchVideoList();
</script>

</body>

</html>

